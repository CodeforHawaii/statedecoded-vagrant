# State Decoded  / Vagrant Configuration

A Vagrant configuration for State Decoded, to make it easy to get started.

### Install Vagrant

Installing Vagrant is very simpleâ€”simply [follow the instructions](http://docs.vagrantup.com/v2/installation/).

### Start the Vagrant Machine

* Download a copy of this repository and unzip it into a directory.
* At the command line, change into the directory that contains this repository.
* Download the git submodules using: `git submodule init; git submodule update`
* Run the command `vagrant up`. (This can take <10 minutes)

### Watch puppet take care of most of the installation! (hopefully!)
We are using puppet to provision our virtural machine. If you run into problems
at this stage please open a bug on github. Once puppet has finished running
severl things have happened:

* An apache server is running with its doc root at /var/www/statedecoded/htdocs
* A solr server is running with its home set to /var/www/statedecoded/solr_home
* A mysql server is running with a username and password specified at the top of
* manifests/default.pp (the root mysql password can be found at `~/root-mysql/.my.cnf`
* php and all of its dependencies have been installed

At this point you are extremely close to having a running instance of the
statedecoded. What you need to do is finish the
configuration/setup of the statedecoded itself. Refer to the [manual](http://statedecoded.github.io/documentation/installation.html#basic-configuration) for the
rest of the pieces. Namely, you still need to download some laws in XML to
import and then run the law importer. Before doing this you should test your
enviroment by going to http://192.168.42.33/admin/ and running the tests. Make
sure everything passses, if you can't figure it out, just ask somebody.  Once that is all done you should
be able to run the parser at http://192.168.42.33/admin/ that imports the laws into mysql and solr.


### If all else fails!

If the puppet install is causing more problems than it is worth try the manual
installation. Create a new vagrant box and follow the [docs](http://statedecoded.github.io/documentation/installation.html#basic-configuration)!


### Debugging notes

* On your host machine the virtual machine is reachable at 192.168.42.33

* If you want to run puppet from within the vagrant machine run this concise command: 
```bash
puppet apply --verbose --modulepath
'/etc/puppet/modules:/tmp/vagrant-puppet/modules-0' --manifestdir
/tmp/vagrant-puppet/manifests --detailed-exitcodes
/tmp/vagrant-puppet/manifests/default.pp
```

* Which meansthe admin portal for the site lives at http://192.168.42.33/admin

* Solr's admin interface is reachable at:
http://192.168.42.33:8983/solr/#

* You can run solr as a foreground process to see if it is having problems on
startup/running with (assuming you did the puppet install):
`/usr/bin/java -Dsolr.solr.home=/var/www/statedecoded/solr_home
-Djetty.home=/opt/solr/example -Djava.io.tmpdir=/tmp -jar
/opt/solr/example/start.jar`

* The php error log's generated by the statedecoded live in `/var/log/apache2/`

* Remember that patience is a virtue :)

